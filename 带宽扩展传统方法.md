# 传统的带宽扩展算法（非盲式带宽扩展）：

## 1.频带复制法（SBR）

### 背景

需要从可用的（编码）基带中转调信号成分，转调幅度至少为3倍，同时不产生恼人的假象。特别强调的是，要在不违反众所周知的共振-不共振标准的情况下，重新创建心理声学上准确的原始高带信号成分。与原始信号相比，重新制作的高频段信号不一定具有技术意义上的信号一致性，但具有心理声学意义上的一致性，这是最重要的特征

对人类听觉系统的研究表明，听觉主要基于对音频信号的短期频谱分析。研究发现了所谓的掩蔽效应：人类听觉系统无法感知被频谱邻域中更强信号掩蔽的失真。因此，在观察短期频谱时，可以计算出所谓的掩蔽阈值。在理想情况下，低于该阈值的失真是听不到的

### 工作原理

SBR编码器与底层核心编解码器并行工作，但采样率更高。虽然SBR主要是解码器中的后处理过程，但重要参数在编码器中提取，以确保在解码器中进行最精确的高频重构。编码器过程如图8所示。编码器根据当前输入信号的分段特征，估算SBR范围的时间和频率范围/分辨率的频谱包络。频谱包络是通过复杂的QMF分析和随后的能量计算来估算的。频谱包络的时间和频率分辨率可自由选择，以确保为给定的输入信号段提供最合适的时间频率分辨率。包络估计需要考虑到，原声中主要位于高频区域的瞬态（例如高音），在包络调整之前会在SBR生成的高频段中少量出现，因为解码器中的高频段是基于低频段的，与高频段相比，低频段的瞬态要不那么明显。与其他音频编码算法中使用的普通频谱包络估计相比，这方面对频谱包络数据的时间频率分辨率提出了不同的要求。

除了频谱包络线外，还能提取代表不同时间和频率区域输入信号频谱特征的其他几个参数。由于编码器自然可以获得原始信号以及解码器中的SBR单元将如何创建高频段的信息，再加上特定的控制参数集，因此系统可以处理这样的情况：低频段由强谐波序列构成，而要重新创建的高频段主要由随机信号成分构成；原始高频段中存在强音调成分，而高频段区域所基于的低频段中却没有对应的音调成分。此外，SBR编码器与底层核心编解码器密切配合，以评估SBR在给定时间内应覆盖的频率范围。在立体声信号的情况下，通过利用控制数据的熵编码和信道相关性，在传输之前对SBR数据进行有效编码。控制参数提取算法需要根据给定比特率和给定采样率下的底层编解码器进行仔细调整。这是因为与高比特率相比，低比特率通常意味着更大的SBR范围，而不同的采样率对应于不同的SBR帧时间分辨率。不同的核心编解码器在比特限制期间也会表现出不同的特性，如频谱带关闭的严重程度不同等。解码器由几个不同的部分组成，如图9所示。它包括一个比特流解码模块、一个高频重建（HFR）模块、一个附加高频组件模块和一个包络调整器模块。该系统基于一个复值QMF滤波器组[4]。在比特流提取模块中，控制数据从比特流中读取并解码。在从比特流中读取包络数据并进行解码之前，先获取当前帧的时频网格。如果处理的是立体声信号，则根据控制数据进行适当的立体声解码。还包括适当的CRC校验和抗错算法。

解码是编码的逆过程,将核心解码器输出的低频时域信号经1个QMF分解成32个子带,结合解出的SBR参数在高频重建模块,选择合适的子带用复制方式复制到高频;利用谐波参数(主要为包络和能量信息)进行包络调整,重建出高频的谐波结构。若原信号高频和低频部分没有明显的相关性,则反相滤波器将高频部分调整为类似白噪声的分布

## 2.简化参数的谱扩展算法（SPBE）

SBR提取的参数包括谐波、噪声能量、重建时间/频率边界、反向滤波器系数和弦波合成系数,因此加入比特流中的参数信息量比较大,分析时的复杂度也很高

SPBE在分析高频时着重分析高频部分与低频部分的相关性,采取相关性度量来决定扩展的方法,达到用最相关的低频子带进行扩展得到高频的目的,最后提取的高频参数只含有高、低频相关性信息和高频能量信息。另外,为了保证信号分析时瞬态发生有足够的时间分辨率,加入了瞬态检测模块;时频变换时利用改进型离散余弦变换(ModifiedDiscreteCosineTransform,MDCT)来实现,为减低滤波器组的运算量,采用基于FFT的快速算法

![image-20241127153446373](\image-20241127153446373.png)

(1)瞬态检测模块。对于音频信号高频部分可能出现的瞬态,处理过程中需要保证一定的频率分辨率。SBR处理瞬态信号的方法是计算拟合高频包络与真实高频包络的残差,然后将残差信息传输至解码端。为了降低复杂度而又尽量保证高频重建质量,在SPBE算法设计时加入了瞬态检测单元,以此来决定进行时频变换的块类型。SPBE编码器每次读取1024点音频信号,并以有50%重叠的2048点长帧为处理单元。如果检测到瞬态发生,则处理单元切换为256点的短块,长、短切换之间含有过渡块。一般来说,瞬态检测过程为:将信号进行高通滤波,再计算能量值,如果相邻帧的能量值有较大变化,可判定有瞬态发生。为了得到更精确的检测结果,笔者引入了MP3和AAC中采用的心理声学模型

(2)MDCT时频变换模块。与SBR采用QMF划分成64个子带不同,SPBE采用MDCT滤波器组将时域信号变换至频域。采用MDCT和时域混叠抵消(TimeDomainAliasCancellation,TDAC)可减弱边缘效应,得到信号的频域样值,保证信号完全重建。为了降低运算复杂度,SPBE采用基于N/4点FFT的快速算法[5]。为了和核心编码器保持一致,信号变换前的加窗处理采用正弦窗或KBD窗。时频变换时,每帧之间有50%的重叠,并根据心理声学模型计算得到的块类型来决定是进行长块变换还是短块变换

(3)高、低频相关性检测和高频参数提取模块。音频信号的谐波特性(低频、中低频和高频之间的相关性)是进行频谱扩展的基础。频谱的扩展利用了倍频关系,将中、低频部分的低次谐波首先复制到高频以代替高频部分的高次谐波,然后利用能量信息对包络进行调整,力求得到最好的重建品质。但这种做法有一个前提:中、低频部分只含有单纯的基频和低次谐波,而不能含有太多其他不相关的频率信息。现实中,并不总能满足这个前提。很多音频信号,特别是音乐信号,在频率较低处容易因鼓的打击、BASS的演奏等出现突发的峰值,而这些峰值与高频是不相关的,因此有必要先对高、低频之间的相关性进行判断。SBR的高、低频相关性是通过谐波分析得到的,并根据相关性计算出反相滤波器系数传输至解码端,算法复杂度很大。在SPBE算法设计时,为了解决此问题,引入了1个相关性检测的环节。当检测到中、低频部分和高频部分不相关时,利用白噪声信息来重建高频;检测到相关时,对于高频划分出的每个子带,也在中、低频部分找出相关性最大的子带来进行重建和调整。通过计算相关系数corr来度量相关性,corr表示为

![image-20241127154049971](\image-20241127154049971.png)

其中,x[i],y[i]为不同子带区间内的频域幅值;i为样值序列的序号;N为计算相关性的样值序列的区间长度。设置一个白噪声标识表示为Noise_flag。当计算得到的corr低于经验阈值时,判断为不相关,此时将Noise_flag设置为1,即意味着在解码端会用白噪声来重建高频,同时计算高频部分的能量作为参数传送至解码端来调整包络。当corr高于经验阈值时,将Noise_flag设置为0,即不用白噪声重建高频。此时,首先将高频和中低频部分分别划分成几个子带(可平均划分成8个或16个子带),也可按照人耳听觉特性按照Bark(BARK)频率进行划分;然后计算高频的每个子带与中低频各个子带的相关系数,取系数最大者为匹配子带;最后,计算各个高频子带的能量,连同匹配子带信息一起传送至解码端。SPBE解码器的结构框图如图4所示。解码器首先判断Noise_flag是否为1,如果为1则在高频生成白噪声,并用从编码端接收到的高频能量对幅度进行调整。如果Noise_flag为0,则再次利用和编码端一样的方法将中低频划分成几个子带,结合子带匹配信息,将相应的各个子带复制到高频,并用从编码端接收到的各高频子带能量进行包络调整。调整公式为

![image-20241127154120268](\image-20241127154120268.png)

其中,N是子带区间的长度;madjusted(n)和mcopied(n)分别为包络调整和复制高频的频域信号幅值;eoriginal和ecopied分别为原始与复制子带的幅度值。子带的平均幅度值e定义为

![image-20241127154132921](\image-20241127154132921.png)

![image-20241127154140909](\image-20241127154140909.png)

## 3.Bark带频谱建模(BBSM)法

在编码端，首先对输入音频信号进行FFT变换并计算高频带与本地解码的低频带信息之间的相关系数;其次将输入信号的高频幅度谱与本地解码的低频幅度谱分别按Bark尺度进行子带划分并将高频Bark子带分为N个组低频前M个Bark子带归为一个组这里N应是M的倍数。最后计算各高频子带组与低频子带组的能量比随同低频信息参数一同写入码流。

在解码端，首先对低频解码信息进行采样并利用Bark尺度进行子带划分;其次根据解码的相关系数进行高低频相关性判断当相关系数小于给定阈值时用随机白噪声填充高频各Bark子带;反之将解码的前M个低频Bark子带信息复制到各高频子带组;最后根据解码的高频子带组与低频子带组的能量比对高频Bark子带的能量进行调整完成最终的高频重建。

通过上述原理分析可以看出BBSM方法借助Bark尺度进行非均匀分带[16]使得子带宽度呈指数增长避免了对频带进行均匀划分的缺陷，有效减少了分带数目及表示高频信息的参数。但是由于该方法使用一组相同的Bark带低频信息去重建各组Bark带高频信息，并没有使用与高频子带相关性最大的低频子带去重建高频信息，因此得到的不是最佳的重构信息

### Bark频带频谱建模

Bark（巴克）频率尺度是以Hz为单位，把频率映射到心理声学的24个临界频带上，第25个临界频带占据约：16K~20kHz的频率，1个临界频带的宽度等于一个Bark，简单的说，Bark尺度是把物理频率转换到心理声学的频率。

Bark音阶范围从1到24Bark，对应于听觉的前24个关键频带。已公布的Bark频带边缘以赫兹为单位为[0,100,200,300,400,510,630,770,920,1080,1270,1480,1720,2000,2320,2700,3150,3700,4400,5300,6400,7700,9500,12000,15500][6]。在Bark尺度中，高频区域的频带呈指数增长，因此与线性频域相比，我们可以提取更多的小参数来重建高频段。在编码器中，输入音频信号和AAC编码音频信号的频谱被转换为Bark尺度，提取每个Bark频段的能量并计算能量率。在解码器中，将AAC解码频谱的频谱转换为Bark尺度，并利用能量率扩展高频段的频谱分量。结果频谱转换为线性尺度，并使用反向FFT转换为时域。使用Bark尺度频带处理的主要优点是减少了复制高频分量的参数数量（能量率）。

### 编码器

高频段重构算法基于获取AAC编码音频频谱和输入音频频谱之间的能量率。用于复制高频的能量率数量取决于采样频率和相关的Bark音阶数。当输入音频信号的采样频率为16kHz时，它有24个Bark频段。而当输入信号的采样频率为8kHz时，则只有21个Bark频段。

编码器的具体流程如下，图4是该流程的框图：

（1）将输入音频信号（16位分辨率、16千赫采样率和单声道）向下采样至8千赫，然后用MPEG-2AAC进行压缩。MPEG-2AAC将该信号编码为ADTS标头格式，比特率为8Kbps。

(2)使用256点FFT采集输入音频信号的频谱。分析帧大小为256个采样点，并且是半重叠的。(3)将AAC编码音频信号的频谱上采样到16KHz。

(3)计算输入音频信号的高频段与AAC编码音频信号的低频段之间的相关性，并决定是否进行后续处理。

(5)将输入音频信号和AAC编码音频信号的幅值频谱转换到Barkscale域，并提取能量率，如图5所示。

(6)将能量率量化并复用到MPEG-2AAC比特流中。图6是这些处理的比特流格式。上述过程中需要处理的频带数量取决于目标比特率和所需的音频质量。如果我们复制5kHz的频率成分，只需要3个频段的能量率。能量率充分量化为8比特或更低。因此，用于高频段复制的额外比特为每AAC帧32字节。约占AAC帧长度的25%。此外，如果将能量率制成编码本，我们还可以减少更多比特。

### 解码器

为了保证与一般MPEG-2AAC解码器的兼容性，在MPEG-2AAC帧末尾添加了量化能量率信息。在使用ADTS标头的MPEG-2AAC解码中，必须找到同步帧，然后提取帧大小的长度，因此直到下一个同步帧的最后一个比特流就是该帧的量化能量率。解码器的具体流程如下，图7是该流程的框图：

（1）将输入比特流分为MPEG-2AAC比特流和量化能量率比特流。

(2)对MPEG-2AAC比特流进行解码，并将解码后的频谱上采样至16KHz。最后将其转换为巴克尺度域。

(3)如果设置了白噪声标志，则要复制的高频段将由随机变量产生的白噪声填充。如果未设置白噪声标志，则继续下面的过程。

(4)对附加比特进行去量化后，提取能量率。

(5)将高频段与解码频谱的低频段按能量率缩放后进行复制。图8是解释这一过程的简单示意图。

(6)使用256点FFT提取输入音频信号的频谱。分析帧的大小为256个采样点，并且是半重叠的。

## 4.简化参数的基于BBSM的高频重建方法

在编码端，首先将输入信号等分为N个子带;其次根据子带能量差异和过零率对相邻两帧信号相同低频子带进行相关性判断并提取相关性最强的M个低频子带作为高频重建单元;接着比较相邻两帧高频各子带的能量差异只有当差异值大于给定门限时才传递高、低频子带能量比;最终将提取的M个低频子带的索引值、高频子带的能量差异与高、低频子带能量比参数随同低频信息参数一同写入码流。

在解码端，首先将解码的低频信号等分为N/2个子带;其次利用相邻两帧高频各子带的能量差异进行频带复制判断当差异值大于给定门限时则将M个低频子带复制到高频带并利用高、低频子带能量比对其进行能量调整得到高频信息;反之则填充随机白噪声得到高频信息

此方法避免了BBSM中使用固定的低频信息重建高频信息的缺陷通过选择相关性最好的低频子带对高频带进行重建进一步减少了表示高频的参数有利于提升重建质量

## 5.基于最小熵的音频信号高频重建法

在编码端，输入音频信号经FFT变换后被等分为N个子带将提取的高频各子带的包络能量信息随同低频信息参数一同写入码流。

在解码端，将信号等分为N个子带低频解码信息填入对应的低频子带高频子带均赋为零值同时加入直流信息构成一个全频带信号。经IFFT变换后得到时域信号。将此时域信号作为初始全频带信号结合高频包络能量信息用最小熵算法[1117]循环迭代不断得到新的全频带信号。每次恢复出全频带信号后都将其与初始全频带信号做相关性检测当相关系数小于某个门限值时迭代停止此时恢复的全频带信号即为解码信号。

通过上述原理分析可以看出该方法利用了最小熵准则来对低频信息进行谱外推得到高频信息其核心思想是利用信息熵来度量信号的频谱分辨率通过求取最小信息熵来提高信号的频谱分辨率使得外推得到的高频谱信息更加准确。其重建音频信号的高频谱信息更加丰富从而使得重建信号更加饱满自然。但是由于本方法没有对高频细节谱进行精确恢复当处理高频能量较强的信号时难免会引入轻微的噪声
